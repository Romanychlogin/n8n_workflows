{
  "updatedAt": "2025-11-06T10:38:36.800Z",
  "createdAt": "2025-11-05T16:49:07.256Z",
  "id": "GE66xiztgKP0D3Za",
  "name": "ADS generate for yandex",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -3104,
        -624
      ],
      "id": "61e64565-0f00-4c98-86ff-ee1389281142",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO business_processes_states (business_process_id, company_id,n8n_workflow_execution_id,n8n_workflow_root_execution_id, started)\nSELECT MAX(business_process_id), $2,$3,$4, NOW()\nFROM public.business_processes\nWHERE n8n_process_name = $1;",
        "options": {
          "queryReplacement": "=[{{$workflow.name}},{{$json.company_id}},{{$execution.id}},{{ $('When Executed by Another Workflow').item.json.root_execution_id }}]"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2816,
        -624
      ],
      "id": "f723aa35-b9f6-4301-9a8d-50364c07102b",
      "name": "Mark_workwlow_started",
      "credentials": {
        "postgres": {
          "id": "4YkdFJcdTgzo9hkz",
          "name": "PGvector"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "update business_processes_states set finished=NOW(),steps_passed=1,steps_total=1 where  n8n_workflow_execution_id=$1",
        "options": {
          "queryReplacement": "={{$execution.id}}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -128,
        -1616
      ],
      "id": "4627ef16-c1a6-4a24-ab26-0cd5419ae583",
      "name": "Mark_workflow_completed",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "4YkdFJcdTgzo9hkz",
          "name": "PGvector"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ad24bde8-4a62-4671-ac23-c8ff5d642004",
              "name": "min_limit",
              "value": 450,
              "type": "number"
            },
            {
              "id": "fa758de8-3da4-45ce-9539-b2843cc62eb1",
              "name": "max_limit",
              "value": 500,
              "type": "number"
            },
            {
              "id": "1a8dc5bd-1f84-4a4c-9646-dfdd455f8126",
              "name": "brand_limit",
              "value": 50,
              "type": "number"
            },
            {
              "id": "b6119588-f830-4471-a6af-5cfb8b6cf299",
              "name": "conversions_weight",
              "value": 10,
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2608,
        -624
      ],
      "id": "3b2902e4-f860-410f-81aa-f60e9a4ddb23",
      "name": "Set variables"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "WITH w AS (\n  SELECT COALESCE(count_views,0) + COALESCE(count_convetions,0)*$3 AS weight\n  FROM public.ads_list where company_id=$1\n)\nSELECT COALESCE(\n  (SELECT weight FROM w ORDER BY weight DESC NULLS LAST OFFSET $2 LIMIT 1),\n  (SELECT MIN(weight) FROM w)  -- если строк < 450, берём минимальный вес в таблице\n) AS threshold_weight;",
        "options": {
          "queryReplacement": "={{ $('When Executed by Another Workflow').last().json.company_id }},{{ $json.min_limit }},{{ $json.conversions_weight }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2400,
        -624
      ],
      "id": "e8026fa8-7e06-46f2-8cb8-89247ef5778e",
      "name": "get min limit",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "WITH w AS (\n  SELECT COALESCE(count_views,0) + COALESCE(count_convetions,0)*$3 AS weight\n  FROM public.ads_list where company_id=$1 and is_own_brand=true\n)\nSELECT COALESCE(\n  (SELECT weight FROM w ORDER BY weight DESC NULLS LAST OFFSET $2 LIMIT 1),\n  (SELECT MIN(weight) FROM w)  -- если строк < 450, берём минимальный вес в таблице\n) AS threshold_weight;",
        "options": {
          "queryReplacement": "={{ $('When Executed by Another Workflow').last().json.company_id }},{{ $('Set variables').item.json.brand_limit }},{{ $('Set variables').item.json.conversions_weight }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2256,
        -624
      ],
      "id": "a7caaef8-535a-427d-af0c-e345c5390782",
      "name": "get brand limit",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.ads_list\nSET add_to_hi_demand = TRUE\nWHERE company_id = $1\n  AND (COALESCE(count_views, 0) + COALESCE(count_convetions, 0) * $3) >= $2\n  AND is_hi_demand = FALSE\nRETURNING ad_id,\n          (COALESCE(count_views, 0) + COALESCE(count_convetions, 0) * $3) AS weight",
        "options": {
          "queryReplacement": "={{ $('When Executed by Another Workflow').last().json.company_id }},{{ $('get min limit').last().json.threshold_weight }},{{ $('Set variables').last().json.conversions_weight }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2048,
        -624
      ],
      "id": "7fcc1086-215d-442d-854c-f357b2f63ebc",
      "name": "Mark to move to high demand",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "WITH ranked AS (\n  SELECT\n    ad_id,\n    ROW_NUMBER() OVER (\n      ORDER BY COALESCE(count_views,0) + COALESCE(count_convetions,0)*10 DESC,\n               ad_id\n    ) AS rn\n  FROM public.ads_list\n  WHERE company_id = $1\n)\nUPDATE public.ads_list al\nSET remove_hi_demand = TRUE\nFROM ranked r\nWHERE al.ad_id = r.ad_id\n  AND r.rn > $2\n  AND al.company_id = $1\n  AND al.is_hi_demand = TRUE;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1824,
        -624
      ],
      "id": "3adfeff7-cae1-4aaf-8bd3-8a5f301811bb",
      "name": "Mark to remove from high demand",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select * from ads_list where company_id=$1 and remove_hi_demand=true",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2048,
        -128
      ],
      "id": "ecdaeece-cfb3-4b3a-b278-6eaf22de700a",
      "name": "get to remove",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1536,
        -160
      ],
      "id": "dcf5796a-da2f-4dc1-b65d-e5efb3692590",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1328,
        -48
      ],
      "id": "cdf8fab5-e275-491d-93a3-67c5e84eaacc",
      "name": "Delete yandex group and adv"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "update ads_list set group_yandex_id=null, ads_yandex_id=null, key_word_yandex_id=null,is_hi_demand=false,remove_hi_demand=false",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1120,
        -48
      ],
      "id": "241ba0c6-f889-4b10-be64-7fc09ecc5e62",
      "name": "clear high demand",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select *, length (key_word) as key_word_length from ads_list where company_id=$1 and is_hi_demand=false and group_yandex_id is null AND is_own_brand=false",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1360,
        -464
      ],
      "id": "04251d8c-e828-4df1-ae54-5a8b91f628c7",
      "name": "get low demand to add",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1056,
        -512
      ],
      "id": "e874c39f-162b-4c6d-86e0-0e1f349365e7",
      "name": "Loop Over Items3"
    },
    {
      "parameters": {
        "content": "находим группу для нужной длины у которой ключей меньше 199. Если такой нет - создаем новую и привязываем к ней те же объявления"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -704,
        -704
      ],
      "id": "15e9ba44-c78f-4a3e-97d0-f0b3ea402620",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select * from ads_groups where company_id=$1 and key_word_length=$2 and key_words_count<200",
        "options": {
          "queryReplacement": ""
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -864,
        -432
      ],
      "id": "432f5b2c-f2a5-43d2-ab82-14c55d65faad",
      "name": "get group",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "content": "обновить - группа + to_upload_ad"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -48,
        -480
      ],
      "id": "789e6bee-03d8-4afb-a488-9dedfea6af8e",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2695d6f1-5c0e-414c-aa90-049fa9a2b691",
              "leftValue": "={{ $input.first().json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -672,
        -400
      ],
      "id": "bb0ca27e-e215-4375-9599-415152a55581",
      "name": "If no such group"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "update ads_list set group_yandex_id=$2,to_upload_ad=true  where ad_id=$1",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -64,
        -272
      ],
      "id": "df9f23e0-4ffd-48a3-b696-bfa637d129f1",
      "name": "update ads data",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "errorMessage": "too many ads"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -320,
        -544
      ],
      "id": "e9d3214f-cb55-4ed8-9802-c4d36e5da873",
      "name": "Stop and Error2"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "update ads_groups set key_words_count=key_words_count+1 where ads_group_id=$1",
        "options": {
          "queryReplacement": "={{ $json.ads_group_id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -336,
        -288
      ],
      "id": "70d7b4c3-c5e6-432f-ad3d-32d0709f4a5a",
      "name": "update group",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.ads_list\nSET add_to_hi_demand = TRUE\nWHERE company_id = $1\n  AND (COALESCE(count_views, 0) + COALESCE(count_convetions, 0) * 10) >= $2\n  AND is_hi_demand = FALSE\n  AND is_own_brand=true\nRETURNING ad_id,\n          (COALESCE(count_views, 0) + COALESCE(count_convetions, 0) * 10) AS weight",
        "options": {
          "queryReplacement": ""
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2064,
        -384
      ],
      "id": "996b10c9-1997-4fd0-a758-4f1b623cabe4",
      "name": "Mark to move to high demand brand",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "WITH ranked AS (\n  SELECT\n    ad_id,\n    ROW_NUMBER() OVER (\n      ORDER BY COALESCE(count_views,0) + COALESCE(count_convetions,0)*10 DESC,\n               ad_id\n    ) AS rn\n  FROM public.ads_list\n  WHERE company_id = $1\n  AND is_own_brand=true\n)\nUPDATE public.ads_list al\nSET remove_hi_demand = TRUE\nFROM ranked r\nWHERE al.ad_id = r.ad_id\n  AND r.rn > $2\n  AND al.company_id = $1\n  AND is_own_brand=true\n  AND al.is_hi_demand = TRUE;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1840,
        -384
      ],
      "id": "19f9fcab-bd62-4789-848c-4689749ecadf",
      "name": "Mark to remove from high demand brand",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -464,
        -1184
      ],
      "id": "3ee504d4-2c45-4f95-aa03-4631be97a850",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "content": "находим группу для нужной длины у которой ключей меньше 199. Если такой нет - создаем новую и привязываем к ней те же объявления"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -112,
        -1376
      ],
      "id": "3ccb725b-5e35-45a0-a4df-76f06323f57b",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select * from ads_groups where company_id=$1 and is_own_brand=true and key_words_count<200",
        "options": {
          "queryReplacement": ""
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -272,
        -1104
      ],
      "id": "35ade92d-51f5-440b-b072-1f4aea7779a8",
      "name": "get group1",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "content": "обновить - группа + to_upload_ad"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        544,
        -1152
      ],
      "id": "25bea6cc-e35d-4d31-b367-3c18e0bf9ce1",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2695d6f1-5c0e-414c-aa90-049fa9a2b691",
              "leftValue": "={{ $input.first().json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -80,
        -1072
      ],
      "id": "9f29826c-694e-4fee-addb-338b61fb4a42",
      "name": "If no such group1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "update ads_list set group_yandex_id=$2,to_upload_ad=true  where ad_id=$1",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        528,
        -944
      ],
      "id": "3d4a2f43-7eab-4bbb-aed3-8c21921e1bbf",
      "name": "update ads data1",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "errorMessage": "too many ads"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        272,
        -1216
      ],
      "id": "fc1cd747-d4e1-44c7-b20a-7ae896455367",
      "name": "Stop and Error"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "update ads_groups set key_words_count=key_words_count+1 where ads_group_id=$1",
        "options": {
          "queryReplacement": "={{ $json.ads_group_id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        256,
        -960
      ],
      "id": "b2a2f439-c94e-49b4-b68c-a909a4a5f444",
      "name": "update group1",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select *, length (key_word) as key_word_length from ads_list where company_id=$1 and is_hi_demand=false and group_yandex_id is null AND is_own_brand=true",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -752,
        -1184
      ],
      "id": "cd7e03d5-4980-4ff1-8676-85ab3c165db2",
      "name": "get brand low demand to add",
      "credentials": {
        "postgres": {
          "id": "Hx2VFmUi5WO2K4QX",
          "name": "Postgres account 2"
        }
      }
    }
  ],
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Mark_workwlow_started",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark_workwlow_started": {
      "main": [
        [
          {
            "node": "Set variables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set variables": {
      "main": [
        [
          {
            "node": "get min limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get min limit": {
      "main": [
        [
          {
            "node": "get brand limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get brand limit": {
      "main": [
        [
          {
            "node": "Mark to move to high demand",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark to move to high demand": {
      "main": [
        [
          {
            "node": "Mark to remove from high demand",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark to remove from high demand": {
      "main": [
        [
          {
            "node": "Mark to move to high demand brand",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get to remove": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "get low demand to add",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete yandex group and adv",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete yandex group and adv": {
      "main": [
        [
          {
            "node": "clear high demand",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "clear high demand": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get low demand to add": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items3": {
      "main": [
        [
          {
            "node": "get brand low demand to add",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "get group",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get group": {
      "main": [
        [
          {
            "node": "If no such group",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If no such group": {
      "main": [
        [
          {
            "node": "Stop and Error2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "update group",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update ads data": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update group": {
      "main": [
        [
          {
            "node": "update ads data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark to move to high demand brand": {
      "main": [
        [
          {
            "node": "Mark to remove from high demand brand",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark to remove from high demand brand": {
      "main": [
        [
          {
            "node": "get to remove",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Mark_workflow_completed",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "get group1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get group1": {
      "main": [
        [
          {
            "node": "If no such group1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If no such group1": {
      "main": [
        [
          {
            "node": "Stop and Error",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "update group1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update ads data1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update group1": {
      "main": [
        [
          {
            "node": "update ads data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get brand low demand to add": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "v2Z32ISEUzsFYnZw",
    "availableInMCP": false
  },
  "staticData": {
    "global": {
      "my_prompt": {
        "data": "SYSTEM\n- Твоя задача — по каждой фразе пользователя при поиске: \"{{key_words}}\" создать один короткий заголовок, строго соблюдая правила.\n- В ответе выводи только готовые заголовки в требуемом формате.\n\nCONSTRAINTS\n- Язык вывода — тот же, что у входной фразы.\n- Максимум 56 символов (считай Unicode-символы, а не байты).\n- Разрешены только буквы русского и латинского алфавита и цифры.\n- Никаких кавычек, знаков препинания (кроме пробелов), эмодзи, тегов, разметки, пояснений.\n- Не добавляй слова, не связанные с услугами компании {{company_description}}.\n- Не раскрывай рассуждения.\n\nOUTPUT FORMAT (строго)\n- Выводи по одному заголовку на запись\n- Не добавляй пустых строк до или после.\n- Не добавляй пояснений, слов вроде “Заголовок” и т.п.\n\nRULES FOR GENERATION\n1.\tСохранение слов:\nВсе слова из соответствующей исходной фразы должны присутствовать в заголовке (с возможной перестановкой для правильного порядка слов).\n2.\tКорректность и ясность:\n- Исправь орфографию, грамматику, порядок слов.\n- Удали жаргон, оставив корректный вариант.\n- Начни с заглавной буквы.\n3.\tРелевантность и уточнение:\nЗаголовок должен оставаться максимально близким к исходной фразе, но при этом уточнять её в сторону услуг компании (добавляя контекст — например, “онлайн”, “для детей”, “курсы”, “обучение”, если это соответствует {{company_description}}).\n4.\tОграничение длины:\n- Максимум 56 символов.\n- После обрезки заголовок должен оставаться осмысленным.\n- Никогда не обрывай слова.\n- Если нужно сократить, убирай дополнительные уточнения, но сохраняй смысл и все исходные слова.\n5.\tЗапрещено:\n- Использовать спецсимволы (например, #, –, “, +, .)\n- Выдавать комментарии или пояснения.\n\nPOST-CHECK (всегда перед выводом)\n- Все слова исходной фразы сохранены.\n- Исправлена орфография и порядок слов.\n- Длина ≤ 56 символов.\n- Начинается с заглавной буквы.\n- Текст осмысленный и релевантный услугам компании.\n- Верни для каждого ID фразы соответствующий заголовок\n\n"
      },
      "my_prompt_text": {
        "data": "Есть следующие фразы, заданные пользователем при поиске и подготовленные заголовки объявлений к ним \"{{key_words_ad_headers}}\". Подбери к ним Тексты рекламных объявлений, соблюдая ограничения. \n\n\nCONSTRAINTS\n- Язык вывода: тот же, что у входной фразы.\n- Максимум 81 символ (считай Unicode-символы, а не байты).\n- Никаких кавычек, эмодзи, тегов, пояснений, маркировок.\n- Сначала идёт нормализованный вариант исходной фразы (сохранить все слова, исправить орфографию/жаргон/порядок слов).\n- Спецсимволы из фразы уже удалены — не добавляй новые.\n- Текст должен быть связным и осмысленным.\n- Текст должен расширять соответствующий заголовок обьявления \n- Желательно добавить призыв к действию (CTA), если помещается.\n- Если после правок длина >81, сокращай по приоритету: (1) убери/сократи вторичные уточнения, (2) минимизируй CTA, (3) убери прилагательные, (4) оставь только нормализованную фразу (все её слова обязаны сохраниться). Не обрывай слова.\n- Учитывай только услуги компании \"{{company_description}}\" при выборе формулировок, но не добавляй никаких новых услуг или вымышленных фактов.\n\nOUTPUT FORMAT (строго)\n- Для каждого полученного ID верни соответствующий текст.\n- Выводи по одной строке на запись: <Текст объявления>\n- Никаких пустых строк до/после, никаких дополнительных блоков.\n\nNORMALIZATION RULES\n- Сохрани все слова исходной фразы  (включая предлоги/союзы).\n- Исправь опечатки и жаргон, нужна литературная форма.\n- Приведи к естественному порядку слов.\n- Регистр — по нормам языка (первая буква заглавная необязательна).\n- Не добавляй новые слова внутрь нормализованной части до CTA. Допустимы служебные слова после неё (для красивого CTA), если укладываешься в 81 символ.\n\nSAFETY / EDGE CASES\n- Однословные запросы: нормализованная часть = это слово; добавляй краткий CTA, если помещается.\n- Нормализуй орфографию, не усиливай смысл, соблюдай политику безопасности; при сомнении выдай только нормализованную фразу без CTA.\n- Если релевантность CTA к {{company_description}} сомнительна — опусти CTA, сохрани связность.\n- Избегай грубой лексики, некорректных/агрессивных/взрослых терминов \n\nPOST-CHECK (всегда перед выводом)\n- Все слова исходной фразы сохранены и стоят в естественном порядке.\n- Длина ≤ 81 символ (Unicode).\n- Нет оборванных слов и лишних символов.\n- Каждый текст осмысленный, начинается с нормализованной фразы, нет оборванных фраз\n- Каждый текст связан по смыслу с соответствующим заголовком обьявления \n"
      },
      "my_prompt_url": {
        "data": "Есть следующая фразы, заданные пользователями при поиске, подобранные к ней заголовки и тексты рекламных объявлений \"{{key_word_header_ad_text}}\". \nПодбери к каждому набору ссылку на страницу сайта, максимально соответствующую запросу пользователя и тексту. Ответ должен содержать только ссылку. Учитывай то что в исходных фразах удалены все дополнительные символы, такие как #,- и пр. \nВ ответе необходимо вернуть только запрошенную информацию, запрещено добавлять уточнения типа заголовок, ссылка, текст и любые рассуждения. \nВ ответе запрещается использовать ссылки отсутствующие в описании компании или изменять ссылки приведенные в описании.  \nДля каждого полученного ID верни соответствующую ссылку. \nОписание компании:{{company_description}}\n"
      },
      "steps_passed": 35,
      "tokens_used": 20889,
      "company_description": "KIBERone Саратов Октябрьский IT школа KIBERone KIBERone – международная КиберШкола программирования и цифровых технологий для детей от 6 до 14 лет.  Позиционирование бренда: KIBERone — первая международная КиберШкола будущего для IT-поколения 6–14 лет, признана ЮНЕСКО лучшей детской образовательной IT-школой в мире. Бренд является партнером Microsoft, Roblox и Samsung. Бесплатные пробные уроки  Основные услуги и программы:  Полный перечень модулей:  Вводный модуль (основы цифровой грамотности)  Основы программирования Scratch Jr  Создание игр на Scratch  ПиктоМир (алгоритмическое мышление)  CodeMonkey (логика и программирование)  Устройство компьютера  Эффектные презентации (PowerPoint, Desygner)  QR-коды  Деловые люди (предпринимательство)  Google Blockly (визуальное программирование)  Roblox Studio (создание игр)  Kodu Game Lab (3D-программирование)  Разработка мобильных приложений в Thunkable  Blender (3D-моделирование)  Компьютерная грамотность  Minecraft Education  Нейросети (основы ИИ)  Alice 3D (3D-программирование)  Run Marco (основы алгоритмов)  Исполнители: Чертёжник и Черепашка  GIF-анимация  Tinkercad (3D-проектирование)  Кибербезопасность  Construct 2 (создание 2D-игр)  Компас-3D (САПР)  Основы HTML (веб-разработка)  Голосовой помощник Алиса  Создание лендинга (Tilda)  Python (создание игр)  Чат-бот на Python  Web-дизайн (Figma)  Web-мастер (HTML+CSS)  Motion Design  Unreal Engine 4 (игровой движок)  JavaScript (игры)  C# (создание 2D-игр)  C++  Java (создание приложений)  Unity 3D (игры)  Олимпиадное программирование  Облачные технологии, Блокчейн, Data Science  PHP+SQL  Photoshop  Подготовка к олимпиадам  Приложения Google  Летние программы:  Летние IT-интенсивы (краткосрочные программы по направлениям Roblox, Minecraft, Python и др.)  Летние КИБЕРканикулы (городской лагерь с IT-обучением и развлекательной программой)  Дополнительные механики:  Кибервалюта («кибероны») для мотивации учеников, обмен на мерч на КиберМаркете  Тьюторы и преподаватели:  Опытные специалисты с практическим опытом и педагогической подготовкой  Другие важные разделы:  Новости (новости школы и сети)  СМИ о нас (публикации о школе)  Фотогалерея (фото с мероприятий и уроков)  Видео (видеоматериалы о школе)  Расписание занятий (время занятий для групп и пробных уроков)  Локации (адрес школы в Октябрьском районе Саратова, ул. Тараса Шевченко, 8)  Оплата (способы оплаты и договор-оферта)  Сертификаты (активация промокодов партнеров)  Контакты (телефон +7 963 112-49-11, email saratov@kiber-one.com",
      "company_description_with_url": "KIBERone Саратов Октябрьский IT школа KIBERone KIBERone – международная КиберШкола программирования и цифровых технологий для детей от 6 до 14 лет.  Позиционирование бренда: KIBERone — первая международная КиберШкола будущего для IT-поколения 6–14 лет, признана ЮНЕСКО лучшей детской образовательной IT-школой в мире. Бренд является партнером Microsoft, Roblox и Samsung. Бесплатные пробные уроки  Основные услуги и программы:  Полный перечень модулей:  Вводный модуль (основы цифровой грамотности)  Основы программирования Scratch Jr  Создание игр на Scratch  ПиктоМир (алгоритмическое мышление)  CodeMonkey (логика и программирование)  Устройство компьютера  Эффектные презентации (PowerPoint, Desygner)  QR-коды  Деловые люди (предпринимательство)  Google Blockly (визуальное программирование)  Roblox Studio (создание игр)  Kodu Game Lab (3D-программирование)  Разработка мобильных приложений в Thunkable  Blender (3D-моделирование)  Компьютерная грамотность  Minecraft Education  Нейросети (основы ИИ)  Alice 3D (3D-программирование)  Run Marco (основы алгоритмов)  Исполнители: Чертёжник и Черепашка  GIF-анимация  Tinkercad (3D-проектирование)  Кибербезопасность  Construct 2 (создание 2D-игр)  Компас-3D (САПР)  Основы HTML (веб-разработка)  Голосовой помощник Алиса  Создание лендинга (Tilda)  Python (создание игр)  Чат-бот на Python  Web-дизайн (Figma)  Web-мастер (HTML+CSS)  Motion Design  Unreal Engine 4 (игровой движок)  JavaScript (игры)  C# (создание 2D-игр)  C++  Java (создание приложений)  Unity 3D (игры)  Олимпиадное программирование  Облачные технологии, Блокчейн, Data Science  PHP+SQL  Photoshop  Подготовка к олимпиадам  Приложения Google  Летние программы:  Летние IT-интенсивы (краткосрочные программы по направлениям Roblox, Minecraft, Python и др.)  Летние КИБЕРканикулы (городской лагерь с IT-обучением и развлекательной программой)  Дополнительные механики:  Кибервалюта («кибероны») для мотивации учеников, обмен на мерч на КиберМаркете  Тьюторы и преподаватели:  Опытные специалисты с практическим опытом и педагогической подготовкой  Другие важные разделы:  Новости (новости школы и сети)  СМИ о нас (публикации о школе)  Фотогалерея (фото с мероприятий и уроков)  Видео (видеоматериалы о школе)  Расписание занятий (время занятий для групп и пробных уроков)  Локации (адрес школы в Октябрьском районе Саратова, ул. Тараса Шевченко, 8)  Оплата (способы оплаты и договор-оферта)  Сертификаты (активация промокодов партнеров)  Контакты (телефон +7 963 112-49-11, email saratov@kiber-one.com сервис доступен по адресу: https://saratov-okt.kiber-one.com/",
      "ai_calls": 10
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "When Executed by Another Workflow": [
      {
        "json": {
          "id": "lBAh8kjoXRX0aGUF",
          "root_execution_id": 179684,
          "company_id": 1,
          "threshhold": "0.79",
          "import_id": "10"
        }
      }
    ]
  },
  "versionId": "da4cd5e4-b985-402e-a342-fc0df19857f4",
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-11-05T16:49:07.256Z",
      "createdAt": "2025-11-05T16:49:07.256Z",
      "role": "workflow:owner",
      "workflowId": "GE66xiztgKP0D3Za",
      "projectId": "spKmbJLU4mvACXIB"
    }
  ],
  "tags": [
    {
      "updatedAt": "2025-10-08T11:53:55.048Z",
      "createdAt": "2025-10-08T11:53:55.048Z",
      "id": "bfaXXdoIW5NToPfb",
      "name": "post procesing"
    }
  ]
}