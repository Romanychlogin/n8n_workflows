{
  "createdAt": "2025-09-22T14:01:12.675Z",
  "updatedAt": "2025-10-19T19:22:27.269Z",
  "id": "BKfU7GhWdir6g3Ib",
  "name": "Receive wizard data",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "f82269ff-704f-4478-95d1-f1678f82b1f2",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        80,
        240
      ],
      "id": "25b3119f-f038-43f2-aecf-bfb6dd75516b",
      "name": "Webhook для анкеты на сайте",
      "webhookId": "f82269ff-704f-4478-95d1-f1678f82b1f2"
    },
    {
      "parameters": {
        "jsCode": "// 1) Берём данные: body может быть строкой (urlencoded \"payload\") или уже объектом\nlet data = $json;\nif (typeof data.body === 'string') {\n  try { data = JSON.parse(data.body); }\n  catch {\n    const p = JSON.parse(($json.payload || '{}'));\n    data = p;\n  }\n}\n\n// 2) Нормализуем и плоско мапим только нужные ключи\nconst get = (o, k) => (o && o[k] != null ? String(o[k]) : '');\n\n// 3) Явная метка времени визита (число миллисекунд) + ISO для чтения глазами\nconst nowMs  = Date.now();\nconst nowISO = new Date(nowMs).toISOString();\n\nreturn [{\n  json: {\n    // UTM\n    utm_source:   get(data, 'utm_source'),\n    utm_medium:   get(data, 'utm_medium'),\n    utm_campaign: get(data, 'utm_campaign'),\n    utm_term:     get(data, 'utm_term'),\n    utm_content:  get(data, 'utm_content'),\n    // clids\n    yclid:        get(data, 'yclid'),\n    // спец\n    etext:        get(data, 'etext'),\n    // контекст\n    referrer:     get(data, 'referrer'),\n    page_url:     get(data, 'page_url'),\n    page_title:   get(data, 'page_title'),\n    client_ID:    get (data, 'yandex_client_id'),\n    // ➕ время визита\n    // ts_site:      nowMs,   // <— числом\n    // ts_site_iso:  nowISO,   // <— строкой (удобно в таблице)\n    pending:      true\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        288,
        240
      ],
      "id": "a5ce8961-8e00-4ffa-b9ed-115560f25de7",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "XlfQhVUBPeep3gvZ",
          "mode": "list",
          "cachedResultName": "site leads",
          "cachedResultUrl": "/projects/spKmbJLU4mvACXIB/datatables/XlfQhVUBPeep3gvZ"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "utm_source",
              "displayName": "utm_source",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "utm_medium",
              "displayName": "utm_medium",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "utm_campaign",
              "displayName": "utm_campaign",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "utm_term",
              "displayName": "utm_term",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "utm_content",
              "displayName": "utm_content",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "yclid",
              "displayName": "yclid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "etext",
              "displayName": "etext",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "referrer",
              "displayName": "referrer",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "page_url",
              "displayName": "page_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "page_title",
              "displayName": "page_title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "pending",
              "displayName": "pending",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "client_ID",
              "displayName": "client_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        496,
        240
      ],
      "id": "e254c502-cf6c-4001-8928-80bc4122d443",
      "name": "Insert row"
    },
    {
      "parameters": {
        "content": "## website visitor процесс\nСлушает webhook, который отправляется при открытии визарда записи (добавлен при помощи тег менеджера). Получает все данные ЯД посетителя (либо понимает, что их нет) и сохраняет их в базу Site leads ",
        "height": 192,
        "width": 400
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        48,
        16
      ],
      "typeVersion": 1,
      "id": "89e8cc60-be1d-4168-b653-ff0f5ce1ad93",
      "name": "Sticky Note"
    }
  ],
  "connections": {
    "Webhook для анкеты на сайте": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Insert row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Webhook для анкеты на сайте": [
      {
        "json": {
          "headers": {
            "host": "n8n-main-production-4310.up.railway.app",
            "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36",
            "content-length": "518",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br, zstd",
            "accept-language": "en-US,en-RU;q=0.9,en;q=0.8,ru-RU;q=0.7,ru;q=0.6",
            "content-type": "text/plain;charset=utf-8",
            "origin": "https://saratov-okt.kiber-one.com",
            "priority": "u=4, i",
            "referer": "https://saratov-okt.kiber-one.com/",
            "sec-ch-ua": "\"Google Chrome\";v=\"141\", \"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"141\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"macOS\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "no-cors",
            "sec-fetch-site": "cross-site",
            "sec-fetch-storage-access": "active",
            "x-forwarded-for": "109.245.164.213",
            "x-forwarded-host": "n8n-main-production-4310.up.railway.app",
            "x-forwarded-proto": "https",
            "x-railway-edge": "railway/europe-west4-drams3a",
            "x-railway-request-id": "kTRCnECUSJW6rFfHrJsmnA",
            "x-real-ip": "109.245.164.213",
            "x-request-start": "1760899256071"
          },
          "params": {},
          "query": {},
          "body": "{\"utm_source\":\"\",\"utm_medium\":\"\",\"utm_campaign\":\"\",\"utm_term\":\"\",\"utm_content\":\"\",\"etext\":\"\",\"yclid\":\"\",\"gclid\":\"\",\"fbclid\":\"\",\"msclkid\":\"\",\"referrer\":\"https://saratov.kiber-one.com/\",\"page_url\":\"https://saratov-okt.kiber-one.com/\",\"page_title\":\"KIBERone — IT-школа программирования для детей в Саратове\",\"is_yandex_direct\":false,\"yandex_reason\":\"none\",\"decision_mode\":\"first_touch\",\"decided_source_id\":3,\"yandex_client_id\":\"1758746484965308286\",\"ts\":\"2025-10-19T18:40:55.828Z\"}",
          "webhookUrl": "https://n8n-main-production-4310.up.railway.app/webhook/f82269ff-704f-4478-95d1-f1678f82b1f2",
          "executionMode": "production"
        }
      }
    ]
  },
  "versionId": "8a59f321-570a-4d81-b402-a1db560a2a94",
  "triggerCount": 1,
  "shared": [
    {
      "createdAt": "2025-09-22T14:01:12.675Z",
      "updatedAt": "2025-09-22T14:01:12.675Z",
      "role": "workflow:owner",
      "workflowId": "BKfU7GhWdir6g3Ib",
      "projectId": "spKmbJLU4mvACXIB"
    }
  ],
  "tags": []
}