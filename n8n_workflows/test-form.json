{
  "updatedAt": "2025-11-10T10:11:53.164Z",
  "createdAt": "2025-11-09T14:44:54.282Z",
  "id": "XsTmBlu5hybU9K85",
  "name": "Test form",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://kiberonesaratov.s20.online/v2api/auth/login",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "email",
              "value": "romanych.mail@yandex.ru"
            },
            {
              "name": "api_key",
              "value": "7787cfc1-47a2-11f0-b9b8-3cecefbdd1ae"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -272,
        -208
      ],
      "id": "ae077d4d-f575-4b04-862c-b94ad485c1c6",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://kiberonesaratov.s20.online/v2api/1/lesson/index",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-ALFACRM-TOKEN",
              "value": "={{ $json.token }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "lesson_type_id",
              "value": "3"
            },
            {
              "name": "status",
              "value": "1"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -64,
        -208
      ],
      "id": "773f88e1-ed4c-48ff-ba22-fcc9659a5f37",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript)\n\n// 1) Достаём массив lessons из входного JSON, независимо от того,\n//    пришёл ли он как объект с items или как массив с объектом внутри.\nconst payload = $input.first().json;\n\nlet lessons = [];\nif (Array.isArray(payload)) {\n  lessons = payload[0]?.items ?? [];\n} else if (Array.isArray(payload?.items)) {\n  lessons = payload.items;\n} else if (payload && Array.isArray(payload[0]?.items)) {\n  lessons = payload[0].items;\n} else if (Array.isArray(payload)) {\n  lessons = payload; // на случай, если сами items пришли напрямую\n}\n\nconst pad = n => String(n).padStart(2, '0');\nconst now = new Date();\nconst todayStr = `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}`;\n\n// 2) Фильтруем занятия по дате (не старше текущей даты)\nconst futureOrToday = lessons.filter(l => typeof l?.date === 'string' && l.date >= todayStr);\n\n// 3) Собираем уникальные даты и сортируем\nconst dateSet = new Set(futureOrToday.map(l => l.date));\nconst dates = Array.from(dateSet).sort();\n\n// 4) Строим адресованный массив времен по датам\nconst timesByDate = {};\nfor (const l of futureOrToday) {\n  const date = l.date;\n  // Безопасно извлекаем \"HH:MM\" из строк вида \"YYYY-MM-DD HH:MM:SS\"\n  const from = typeof l.time_from === 'string' ? l.time_from.slice(11, 16) : null;\n  const to   = typeof l.time_to   === 'string' ? l.time_to.slice(11, 16)   : null;\n\n  if (!from || !to) continue;\n\n  if (!timesByDate[date]) timesByDate[date] = [];\n  timesByDate[date].push({ from, to });\n}\nconst src = $('Webhook').last()?.json ?? {};\n\n\nlet out = [];\n\nif ($('Webhook').first().json.body.type === 'dates') {\n  out = Array.isArray(dates) ? dates : [];\n} else if ($('Webhook').first().json.body.type === 'times') {\n  const list = timesByDate?.[$('Webhook').first().json.body.selected_date];\n  out = Array.isArray(list) ? list : [];\n}\n\n// Возвращаем один item\nreturn [{ json: { availible_lessons:out } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        144,
        -208
      ],
      "id": "d550a73c-1199-45ac-9b27-4d40a4c232a1",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "12b5fd5b-882f-44bc-95a5-3a7baf31d4e3",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -512,
        -208
      ],
      "id": "81959dde-03f0-470b-aa09-2575fab7dead",
      "name": "Webhook",
      "webhookId": "12b5fd5b-882f-44bc-95a5-3a7baf31d4e3"
    },
    {
      "parameters": {
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "https://trylesson.storage.yandexcloud.net"
              },
              {
                "name": "Vary",
                "value": "Origin"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        352,
        -208
      ],
      "id": "e2d4a082-f046-4cc6-8747-ef7c7122c2c6",
      "name": "Respond to Webhook1"
    }
  ],
  "connections": {
    "HTTP Request": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "d12ea506-5953-49f5-abea-063a4c6b9a4d",
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2025-11-09T14:44:54.282Z",
      "createdAt": "2025-11-09T14:44:54.282Z",
      "role": "workflow:owner",
      "workflowId": "XsTmBlu5hybU9K85",
      "projectId": "spKmbJLU4mvACXIB"
    }
  ],
  "tags": []
}