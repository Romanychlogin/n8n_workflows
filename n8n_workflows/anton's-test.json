{
  "createdAt": "2025-09-22T14:01:12.675Z",
  "updatedAt": "2025-10-07T21:06:01.574Z",
  "id": "BKfU7GhWdir6g3Ib",
  "name": "Anton's test",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "f82269ff-704f-4478-95d1-f1678f82b1f2",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        80,
        240
      ],
      "id": "25b3119f-f038-43f2-aecf-bfb6dd75516b",
      "name": "Webhook для анкеты на сайте",
      "webhookId": "f82269ff-704f-4478-95d1-f1678f82b1f2"
    },
    {
      "parameters": {
        "jsCode": "// 1) Берём данные: body может быть строкой (urlencoded \"payload\") или уже объектом\nlet data = $json;\nif (typeof data.body === 'string') {\n  try {\n    data = JSON.parse(data.body);  // твой payload\n  } catch (e) {\n    // если приходят как form fields ?payload=...\n    const p = JSON.parse(($json.payload || '{}'));\n    data = p;\n  }\n}\n\n// 2) Нормализуем и плоско мапим только нужные ключи (все как строки)\nconst get = (o, k) => (o && o[k] != null ? String(o[k]) : '');\n\nreturn [\n  {\n    json: {\n      // UTM\n      utm_source:  get(data, 'utm_source'),\n      utm_medium:  get(data, 'utm_medium'),\n      utm_campaign:get(data, 'utm_campaign'),\n      utm_term:    get(data, 'utm_term'),\n      utm_content: get(data, 'utm_content'),\n      // clids\n      yclid:       get(data, 'yclid'),\n      gclid:       get(data, 'gclid'),\n      fbclid:      get(data, 'fbclid'),\n      msclkid:     get(data, 'msclkid'),\n      // спец\n      etext:       get(data, 'etext'),\n      // контекст\n      referrer:    get(data, 'referrer'),\n      page_url:    get(data, 'page_url'),\n      page_title:  get(data, 'page_title'),\n      // наша логика\n      is_yandex_direct: get(data, 'is_yandex_direct'),\n      yandex_reason:    get(data, 'yandex_reason'),\n      decision_mode:    get(data, 'decision_mode'),\n      decided_source_id:get(data, 'decided_source_id'),\n      ts:               get(data, 'ts')\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        288,
        240
      ],
      "id": "a5ce8961-8e00-4ffa-b9ed-115560f25de7",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "wKRM5hL5MfpAIOSI",
          "mode": "list",
          "cachedResultName": "site_leads",
          "cachedResultUrl": "/projects/spKmbJLU4mvACXIB/datatables/wKRM5hL5MfpAIOSI"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        496,
        240
      ],
      "id": "7eb21cf2-3466-431a-ae78-31ccbaeca46e",
      "name": "Insert row"
    }
  ],
  "connections": {
    "Webhook для анкеты на сайте": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Insert row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "0222b501-f377-4e85-b5c9-e092fedbaf25",
  "triggerCount": 1,
  "shared": [
    {
      "createdAt": "2025-09-22T14:01:12.675Z",
      "updatedAt": "2025-09-22T14:01:12.675Z",
      "role": "workflow:owner",
      "workflowId": "BKfU7GhWdir6g3Ib",
      "projectId": "spKmbJLU4mvACXIB"
    }
  ],
  "tags": []
}